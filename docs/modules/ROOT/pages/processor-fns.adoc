= Processor Functions

Processor functions can be composed to a pipeline. Each function in a pipeline has to have a unique name. +
If an error occurs during function execution or a validation fails, the unchanged input from the pipeline will be sent to the error topic. The message sent to the error topic will take two headers:

- x-exception-message: The message text of the exception
- x-exception-fqcn: The full qualified classname of the exception

== hasValueValidator
image:hasValueValidator.png[]

If the Json element at the given path does not have a value, an error is emitted. +
Having a value means:

- the element exists
- the element value is not null
- for a textual single value: the string is not empty
- for a multivalue: the array contains at least one textual element which is not empty

=== Parameters

|===
|Parameter Name |Type |Required | Description

|name
|String
|Yes
|The name of the function instance

|elementPath
|https://www.rfc-editor.org/rfc/rfc6901[Json Pointer]
|Yes
|The Pointer to the element to be checked
|===

=== Example
==== Configuration
image:hasValueValidator.png[]

==== Valid Input (single value)
[source, json]
----
{
  "id": "ID_1"
}
----

==== Valid Input (multivalue)
[source, json]
----
{
  "id": [null, "ID_X"]
}
----

==== Invalid Input (element does not exist)
[source, json]
----
{
  "name": "Without id"
}
----

==== Invalid Input (null value)
[source, json]
----
{
  "id": null
}
----

==== Invalid Input (empty string)
[source, json]
----
{
  "id": ""
}
----

==== Invalid Input (multivalue with no non empty string)
[source, json]
----
{
  "id": [null, ""]
}
----

== trimNormalizer
image:trimNormalizer.png[]

== padNormalizer
image:padNormalizer.png[]

== Match
image:Match.png[]

image:fromInput.png[]

image:literal.png[]

== Reduce2One
image:reduce2One.png[]

The `Reduce2One` reads a message from the output of the `Match` function, and tries to solve the ambiguous match situation to reduce the matched entities to one entity, under these conditions:

* If the `matches` element only contains one item, it does nothing and sends the input message as output.
* If the `matches` element contains no item, it adds a matched entity to the `matches` with an empty `source` element.
* If the `matches` element contains more than one item, it returns the highest `score` matched entity. (If the `matches` element contains more than one item with the highest score, it returns the first matched with the highest score.)

*Note:*

* If the `matches` element does not exist, or is not an array, the `Reduce2One` raises an exception.
* If the `matches` element contains more than one item, and one of these items does not contain the `score` element, or the `score` element is not numeric, it would be replaced with the default value equal to `1.0`


=== Parameters
[cols="1,1,1,a", options="autowidth"]
|===
|Parameter Name |Type |Required | Description

|name
|String
|Yes
|The name of the function instance

|===

=== Example

==== One item in the `matches` element
===== Input sample
[source, json]
----
{
    "input": {"id": "ID1"},
    "matches": [
        {"id": "match1", "score": 1.0, "source": {"foo": "bar"}}
    ]
}
----

===== Output sample
[source, json]
----
{
    "input": {"id": "ID1"},
    "matches": [
        {"id": "match1", "score": 1.0, "source": {"foo": "bar"}}
    ]
}
----

==== No item in the `matches` element
===== Input sample
[source, json]
----
{
    "input": {"id": "ID1"},
    "matches": []
}
----

===== Output sample
[source, json]
----
{
    "input": {"id": "ID1"},
    "matches": [
        {"source":{}}
    ]
}
----

==== More than one item in the `matches` element
===== Input sample
[source, json]
----
 {
    "input": {"id": "ID1"},
    "matches": [
        {"id": "match1", "score": 0.98, "source": {"foo": "bar"}},
        {"id": "match2", "score": 0.99, "source": {"foo": "baz"}},
        {"id": "match3", "score": 0.99, "source": {"foo": "bad"}}
    ]
}
----

===== Output sample
[source, json]
----
{
    "input": {"id": "ID1"},
    "matches": [
        {"id": "match2", "score": 0.99, "source": {"foo": "baz"}}
    ]
}
----


== MergeCreate
image:MergeCreate.png[]

image:mapping.png[]

== ChangeEventEmit
image:ChangeEventEmit.png[]

== Multiple Functions
image:multipleFns.png[]

