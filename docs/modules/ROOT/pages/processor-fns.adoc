= Processor Functions

Processor functions can be composed to a pipeline. Each function in a pipeline has to have a unique name. +
If an error occurs during function execution or a validation fails, the unchanged input from the pipeline will be sent to the error topic. The message sent to the error topic will take two headers:

- x-exception-message: The message text of the exception
- x-exception-fqcn: The full qualified classname of the exception

== hasValueValidator
image:hasValueValidator.png[]

If the Json element at the given path does not have a value, an error is emitted. +
Having a value means:

- the element exists
- the element value is not null
- for a textual single value: the string is not empty
- for a multivalue: the array contains at least one textual element which is not empty

=== Parameters

|===
|Parameter Name |Type |Required | Description

|name
|String
|Yes
|The name of the function instance

|elementPath
|https://www.rfc-editor.org/rfc/rfc6901[Json Pointer]
|Yes
|The Pointer to the element to be checked
|===

=== Example
==== Configuration
image:hasValueValidator.png[]

==== Valid Input (single value)
[source, json]
----
{
  "id": "ID_1"
}
----

==== Valid Input (multivalue)
[source, json]
----
{
  "id": [null, "ID_X"]
}
----

==== Invalid Input (element does not exist)
[source, json]
----
{
  "name": "Without id"
}
----

==== Invalid Input (null value)
[source, json]
----
{
  "id": null
}
----

==== Invalid Input (empty string)
[source, json]
----
{
  "id": ""
}
----

==== Invalid Input (multivalue with no non empty string)
[source, json]
----
{
  "id": [null, ""]
}
----

== trimNormalizer
image:trimNormalizer.png[]

== padNormalizer
image:padNormalizer.png[]

== Match
image:Match.png[]

image:fromInput.png[]

image:literal.png[]

== Reduce2One
image:reduce2One.png[]

== MergeCreate
image:MergeCreate.png[]

image:mapping.png[]

== ChangeEventEmit
image:ChangeEventEmit.png[]

image:topic.png[]

The `ChangeEventEmit` function reads a message from input, could extract content and message key from the Json content of the message, and could emit the extracted message key and content in the normal output topic of the pipeline or a specific configured topic.

=== Parameters
[cols="1,1,1,a", options="autowidth"]
|===
|Parameter Name |Type |Required | Description

|name
|String
|Yes
|The name of the function instance

|eventContent
|https://www.rfc-editor.org/rfc/rfc6901[Json Pointer]
|Yes
|The `ChangeEventEmit` function extracts the content of the emitted message by using this Json Pointer.

|eventKey
|https://www.rfc-editor.org/rfc/rfc6901[Json Pointer]
|No
|The `ChangeEventEmit` function extracts the message key of the emitted message by using this Json Pointer.

|topic
|String
|No
|The destination topic for emitted messages.

Notes:

* The `topic` is an optional config. If it is set, the `ChangeEventEmit` function uses this config and emits the messages to this topic, and if it is not set, the `ChangeEventEmit` function emits messages to the normal output topic of pipelines.

|cleanUpMode
|enum
|No
|Determine the cleanup mode of the `topic`. The validated content for cleanUpMode is:  `COMPACT`, `DELETE`.

Notes:

* If the topic is set, the default value for `cleanUpMode` is `COMPACT`
* For more information, please check these links: https://kafka.apache.org/documentation/#compaction[Log Compaction] (related to the `COMPACT` config) , https://learn.conduktor.io/kafka/kafka-topic-configuration-log-retention[Log Retention] (related to the `DELETE` config)

|cleanUpTimeHours
|int
|No
|Determine the cleanup time in hour of the `topic`.

Notes:

* If the topic is set, the default value for `cleanUpTimeHours` is `336`

|===

=== Example
==== Configuration
image:ChangeEventEmit-Configured1.png[]

----
Function configuration:
    eventContent: /input
    topic: source
    cleanUpMode: DELETE
    cleanUpTimeHours: 12
----

===== Sample input
[source, json]
----
{
    "input": {"foo": "bar"},
    "matches": [
      {"id": "0815", "source":{"foo": "baz"}}
    ]
}
----

===== Sample output to the source topic
[source, json]
----
{
  "foo": "bar"
}
----

==== Configuration
image:ChangeEventEmit-Configured2.png[]

----
Function configuration:
    eventContent: /matches/0/source
    eventKey: /matches/0/id
----



===== Sample input
[source, json]
----
{
    "input": {"foo": "bar"},
    "matches": [
      {"id": "0815", "source":{"foo": "baz"}}
    ]
}
----

===== Sample output to the normal pipeline output topic
[source, json]
----
{
  "foo": "baz"
}
----

And the message key for the output message is `0815`

== Multiple Functions
image:multipleFns.png[]

