= Processor Functions

Processor functions can be composed to a pipeline. Each function in a pipeline has to have a unique name. +
If an error occurs during function execution or a validation fails, the unchanged input from the pipeline will be sent to the error topic. The message sent to the error topic will take two headers:

- x-exception-message: The message text of the exception
- x-exception-fqcn: The full qualified classname of the exception

== hasValueValidator
image:hasValueValidator.png[]

If the Json element at the given path does not have a value, an error is emitted. +
Having a value means:

- the element exists
- the element value is not null
- for a textual single value: the string is not empty
- for a multivalue: the array contains at least one textual element which is not empty

=== Parameters

|===
|Parameter Name |Type |Required | Description

|name
|String
|Yes
|The name of the function instance

|elementPath
|https://www.rfc-editor.org/rfc/rfc6901[Json Pointer]
|Yes
|The Pointer to the element to be checked
|===

=== Example
==== Configuration
image:hasValueValidator.png[]

==== Valid Input (single value)
[source, json]
----
{
  "id": "ID_1"
}
----

==== Valid Input (multivalue)
[source, json]
----
{
  "id": [null, "ID_X"]
}
----

==== Invalid Input (element does not exist)
[source, json]
----
{
  "name": "Without id"
}
----

==== Invalid Input (null value)
[source, json]
----
{
  "id": null
}
----

==== Invalid Input (empty string)
[source, json]
----
{
  "id": ""
}
----

==== Invalid Input (multivalue with no non empty string)
[source, json]
----
{
  "id": [null, ""]
}
----

== trimNormalizer
image:trimNormalizer.png[]

== padNormalizer
image:padNormalizer.png[]

[#match]
== Match
image:Match.png[]

image:fromInput.png[]

image:literal.png[]

== Reduce2One
image:reduce2One.png[]

== MergeCreate
image:MergeCreate.png[]

image:mapping.png[]

The `MergeCreate` function reads a message from the output of the <<match>> function, and tries to create elements from the input entity to the source-matched entity, under these conditions:

* These changes only affect the first item in the `matches` element.
* The `MergeCreate` configurations determine which element in the input should be mapped to the destination element on the source-matched entity.
* If the source-matched entity contains the mapped element that was determined in the function configuration, the `MergeCreate` function does not touch it.
* If the source-matched entity does not contain the mapped element that was determined in the function configuration, the `MergeCreate` function creates the element and fills it from the mapped element value in the input entity.


=== Parameters
[cols="1,1,1,a", options="autowidth"]
|===
|Parameter Name |Type |Required | Description

|name
|String
|Yes
|The name of the function instance

|mappings
|List
|Yes
|The list of mapping elements between the input and the source-matched entity.

Each item of the list contains 2 elements:

* `from`: That is a https://www.rfc-editor.org/rfc/rfc6901[Json Pointer] and determines the Json element inside the input.
* `to`: That is a https://www.rfc-editor.org/rfc/rfc6901[Json Pointer] and determines the Json element inside the source-matched entity.

|===


=== Example
==== Configuration
image:MergeCreate-Configured.png[]


----
Function configuration:
    mappings: [
        from: /id, to: /identifier/id
        from: /id, to: /ID
        from: /doesNotExist, to: /foo
    ]
----

===== Input sample
[source, json]
----
{
  "input": {
    "id": "ID1"
  },
  "matches": [
    {
      "id": "match!",
      "score": 1.0,
      "source": {
        "id": "TARGET_ID",
        "identifier": {
          "foo": 42
        }
      }
    }
  ]
}
----

===== Output sample
[source, json]
----
{
  "input": {
    "id": "ID1"
  },
  "matches": [
    {
      "id": "match!",
      "score": 1.0,
      "source": {
        "id": "TARGET_ID",
        "identifier": {
          "foo": 42,
          "id": "ID1"
        },
        "ID": "ID1"
      }
    }
  ]
}
----

*Note:* As you can see in the Input and Output sample, if the input entity does not contain the `from` configured element, the `MergeCreate` function does nothing.

== ChangeEventEmit
image:ChangeEventEmit.png[]

== Multiple Functions
image:multipleFns.png[]

